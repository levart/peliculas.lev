
(function($){$.fn.inputMeter=function(options){var css;var isWindows=navigator.appVersion.toLowerCase().indexOf('win')!=-1;$(this).each(function(index,value){var input=$(value);var defaults={maxLength:140,warnLength:110,okStyle:'inputMeterOk',warnStyle:'inputMeterWarn',maxStyle:'inputMeterMax',compensateWindowsNL:true,block:input.is("textarea")};var opts=$.extend(defaults,options);if(opts.block){css={display:'block',marginLeft:3,width:input.innerWidth()}}else{css={};}
var meter=$('<meter></meter>',{min:0,max:opts.maxLength,low:0,high:opts.warnLength-1,css:css}).insertAfter(input);adjustProgress(0);input.keydown(handleKeystroke);function handleKeystroke(event){var key=event.which;var allowKey;var adjustment=1;if((key>=37&&key<=40)||key===9||key===18||key===16||key===27||event.ctrlKey||event.metaKey)
{return true;}
if(key===46||key===8){adjustment=-1;}
if(isWindows&&key===13){adjustment=2;}
allowKey=adjustProgress(adjustment);return adjustment===-1||allowKey;}
function adjustProgress(adjustment){var nNewlines,effectiveLength;var content=input.val();if(opts.compensateWindowsNL&&isWindows){nNewlines=content.split("\n").length;effectiveLength=content.length-nNewlines;}else{effectiveLength=content.length;}
effectiveLength+=adjustment;meter.val(effectiveLength);if(effectiveLength>opts.maxLength){input.val(content.slice(0,opts.maxLength));}
input.removeClass(opts.okStyle+" "+opts.warnStyle+" "+opts.maxStyle);if(effectiveLength>=opts.maxLength){input.addClass(opts.maxStyle);}else if(effectiveLength>=opts.warnLength){input.addClass(opts.warnStyle);}else{input.addClass(opts.okStyle);}
return effectiveLength<=opts.maxLength;}});};})(jQuery);